## 数据同步

### binlog

[binlog](https://www.cnblogs.com/martinzhang/p/3454358.html)

记录内容:除查询外(DDL DML)
性能损耗:%1
使用场景: 主从同步 数据恢复
如何开启: 在[mysqld] 区块添加 log-bin=mysql-bin(日志的前缀),然后重启
如何查看:

```shell
mysql>  show binlog events in 'mysql-bin.000086'
sudo ../bin/mysqlbinlog --no-defaults --base64-output="decode-rows" -v  mysql-bin.000086
```

### 主从复制过程

1. master开启bin-log功能，日志文件用于记录数据库的读写增删,开启I/O线程
2. slave开启I/O线程,SQL线程
3. slave通过I/O线程连接master,请求bin-log,position之后的内容
4. master收到请求,返给slave数据
5. slave收到数据,将bin-log写入relay-log中继日志
6. 开启SQL线程,执行relay-log中的日志

### 复制3种方式

1. STATEMENT(sql语句的复制)

2. ROW(每一行的修改)

3. MIXED(混合模式，如果包含uuid等函数，进行ROW记录)

### 主从数据不一致的原因

1. 人为写入从库
2. 主从复制过程中,主库异常宕机
3. binlog非row格式,一些函数导致(uuid)
4. 异步复制本身不保证

##### 预防措施

1. master:innodb_flush_log_at_trx_commit=1&sync_binlog=1
2. 设置从库只读模式
3. 基于GTID的复制会避免
4. bin-log row
5. 使用5.7版本并行复制

